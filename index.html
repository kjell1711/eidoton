By Jenaro & Kjell                 V 4.7.5.6
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eidoton</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- üí† PWA: Manifest einbinden -->
  <link rel="manifest" href="manifest.json">

  <!-- üí† PWA: iPad/iPhone Vollbild -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- üí† Design-Farbe f√ºr App Titel & Statusbar -->
  <meta name="theme-color" content="#ffffff">

  <style>
    .rounded-3xl { border-radius: 1.5rem; }
    .rounded-2xl { border-radius: 1rem; }
    .rounded-xl { border-radius: .75rem; }
    .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
    .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.08); }
    .transition-all { transition: all .18s ease; }
    .news-text { white-space: pre-wrap; }
    
    /* PIN Pad Styles */
    .pin-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid #3B82F6;
      transition: all 0.2s;
    }
    .pin-dot.filled {
      background: #3B82F6;
    }
    
    /* Tab Bar Active Indicator */
    .tab-active {
      background: #F3F4F6;
    }
    
    /* Flappy Bird Canvas */
    #gameCanvas {
      border-radius: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="antialiased">
  <div id="app" class="flex flex-col h-screen bg-gray-50"></div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBXZG4vsRDqpe_XRHeb64MV-NbLbKtijWs",
    authDomain: "eidoton.firebaseapp.com",
    projectId: "eidoton",
    storageBucket: "eidoton.firebasestorage.app",
    messagingSenderId: "167879420438",
    appId: "1:167879420438:web:f0c10f3a042eb37a1da337",
    measurementId: "G-GCBC06PE3R"
  };

  let db;
  try {
    const firebaseApp = initializeApp(firebaseConfig);
    db = getFirestore(firebaseApp);
    console.log("Firebase initialisiert!");
  } catch (error) {
    console.error("Firebase Fehler:", error);
  }

const configData = {
    questions: {
      mathe: [
       { question: "Berechne 4¬≤", answers: ["14", "16", "18"], correct: 1 },
       { question: "Berechne die Wurzel aus 81", answers: ["7", "9", "10"], correct: 1 },
       { question: "Berechne 3‚Å¥", answers: ["64", "81", "27"], correct: 1 },
       { question: "Berechne die Wurzel aus 144", answers: ["10", "12", "14"], correct: 1 },
       { question: "Berechne 2‚Å∑", answers: ["64", "128", "32"], correct: 1 },
       { question: "Berechne die Wurzel aus 100", answers: ["9", "10", "11"], correct: 1 },
       { question: "Berechne 5¬≤", answers: ["30", "20", "25"], correct: 2 },
       { question: "Berechne die Wurzel aus 64", answers: ["7", "9", "8"], correct: 2 },
       { question: "Berechne 6¬≥", answers: ["125", "216", "64"], correct: 1 },
       { question: "Berechne die Wurzel aus 169", answers: ["14", "13", "15"], correct: 0 },
       { question: "Berechne 10¬≤", answers: ["100", "200", "10"], correct: 0 },
       { question: "Berechne die Wurzel aus 256", answers: ["15", "16", "14"], correct: 1 },
       { question: "Berechne 7¬≤", answers: ["48", "49", "50"], correct: 1 },
       { question: "Berechne die Wurzel aus 196", answers: ["14", "13", "15"], correct: 0 },
       { question: "Berechne 3¬≥", answers: ["30", "27", "24"], correct: 1 },
       { question: "Berechne die Wurzel aus 225", answers: ["15", "14", "16"], correct: 0 },
       { question: "Berechne 8¬≤", answers: ["72", "64", "50"], correct: 1 },
       { question: "Berechne die Wurzel aus 49", answers: ["6", "8", "7"], correct: 2 },
       { question: "Berechne 9¬≥", answers: ["729", "800", "512"], correct: 0 },
       { question: "Berechne die Wurzel aus 81", answers: ["8", "9", "10"], correct: 1 },
       { question: "Berechne 2‚Åµ", answers: ["128", "64", "32"], correct: 0 },
       { question: "Berechne die Wurzel aus 400", answers: ["18", "20", "22"], correct: 1 },
       { question: "Berechne 5¬≥", answers: ["100", "125", "150"], correct: 1 },
       { question: "Berechne die Wurzel aus 121", answers: ["12", "11", "10"], correct: 1 },
       { question: "Berechne 4¬≥", answers: ["128", "64", "256"], correct: 0 },
       { question: "Berechne die Wurzel aus 36", answers: ["7", "6", "8"], correct: 1 },
       { question: "Berechne 3‚Åµ", answers: ["225", "243", "1024"], correct: 1 },
       { question: "Berechne die Wurzel aus 16", answers: ["5", "4", "6"], correct: 1 },
       { question: "Berechne 2‚Å¥", answers: ["8", "16", "32"], correct: 1 },
       { question: "Berechne die Wurzel aus 64", answers: ["7", "8", "6"], correct: 1 },
       { question: "Berechne 6¬≤", answers: ["30", "24", "36"], correct: 2 },
       { question: "Berechne die Wurzel aus 81", answers: ["8", "9", "10"], correct: 1 },
       { question: "Berechne 7¬≥", answers: ["343", "441", "250"], correct: 0 },
       { question: "Berechne die Wurzel aus 49", answers: ["7", "8", "9"], correct: 0 },
       { question: "Berechne 8¬≥", answers: ["1024", "512", "256"], correct: 1 },
       { question: "Berechne die Wurzel aus 256", answers: ["16", "20", "12"], correct: 0 },
       { question: "Berechne 10¬≥", answers: ["1500", "1000", "500"], correct: 1 },
       { question: "Berechne die Wurzel aus 25", answers: ["6", "4", "5"], correct: 2 },
       { question: "Berechne 9¬≤", answers: ["90", "72", "81"], correct: 2 },
       { question: "Berechne die Wurzel aus 9", answers: ["4", "3", "2"], correct: 1 },
       { question: "Berechne 4‚Å¥", answers: ["128", "256", "512"], correct: 1 },
       { question: "Berechne die Wurzel aus 64", answers: ["6", "7", "8"], correct: 2 },
       { question: "Berechne 3‚Å∂", answers: ["512", "729", "1024"], correct: 1 },
       { question: "Berechne die Wurzel aus 36", answers: ["5", "6", "7"], correct: 1 },
       { question: "Berechne 5‚Å¥", answers: ["400", "625", "500"], correct: 1 },
       { question: "Berechne die Wurzel aus 16", answers: ["3", "5", "4"], correct: 2 },
       { question: "Berechne 7¬≤", answers: ["48", "50", "49"], correct: 2 },
       { question: "Berechne die Wurzel aus 121", answers: ["12", "10", "11"], correct: 2 },
       { question: "Berechne 2¬≥", answers: ["10", "6", "8"], correct: 1 },
       { question: "Berechne 2‚Å∏", answers: ["256", "512", "128"], correct: 1 },
       { question: "Berechne die Wurzel aus 225", answers: ["15", "16", "14"], correct: 0 },
       { question: "Berechne 5‚Åµ", answers: ["3125", "1024", "125"], correct: 0 },
       { question: "Berechne die Wurzel aus 49", answers: ["7", "8", "6"], correct: 0 },
       { question: "Berechne 4¬≤", answers: ["16", "18", "14"], correct: 0 },
       { question: "Berechne die Wurzel aus 100", answers: ["9", "10", "11"], correct: 1 },
       { question: "Berechne 3¬≥", answers: ["27", "30", "24"], correct: 0 },
       { question: "Berechne die Wurzel aus 64", answers: ["7", "9", "8"], correct: 2 },
       { question: "Berechne 6‚Å¥", answers: ["1296", "162", "216"], correct: 0 },
       { question: "Berechne die Wurzel aus 81", answers: ["8", "9", "7"], correct: 1 },
       { question: "Berechne 2‚Å∂", answers: ["64", "128", "32"], correct: 0 },
       { question: "Berechne die Wurzel aus 36", answers: ["6", "7", "8"], correct: 0 },
       { question: "Berechne 7¬≥", answers: ["343", "350", "330"], correct: 0 },
       { question: "Berechne die Wurzel aus 169", answers: ["13", "12", "14"], correct: 0 },
       { question: "Berechne 10¬≥", answers: ["1000", "1100", "900"], correct: 0 },
       { question: "Berechne die Wurzel aus 144", answers: ["13", "12", "14"], correct: 1 },
       { question: "Berechne 3¬≤", answers: ["9", "8", "10"], correct: 0 },
       { question: "Berechne die Wurzel aus 256", answers: ["16", "20", "18"], correct: 0 },
       { question: "Berechne 8‚Å¥", answers: ["4096", "1024", "2048"], correct: 0 },
       { question: "Berechne die Wurzel aus 25", answers: ["4", "5", "6"], correct: 1 },
       { question: "Berechne 2‚Å¥", answers: ["16", "8", "32"], correct: 0 },
       { question: "Berechne die Wurzel aus 49", answers: ["6", "7", "8"], correct: 1 },
       { question: "Berechne 9¬≤", answers: ["72", "81", "90"], correct: 1 },
       { question: "Berechne die Wurzel aus 400", answers: ["18", "20", "22"], correct: 1 },
       { question: "Berechne 5¬≥", answers: ["100", "125", "150"], correct: 1 },
       { question: "Berechne die Wurzel aus 121", answers: ["11", "12", "10"], correct: 0 },
       { question: "Berechne 6¬≥", answers: ["216", "200", "250"], correct: 0 },
       { question: "Berechne die Wurzel aus 36", answers: ["5", "6", "7"], correct: 1 },
       { question: "Berechne 7¬≤", answers: ["48", "49", "50"], correct: 1 },
       { question: "Berechne die Wurzel aus 9", answers: ["2", "3", "4"], correct: 1 },
       { question: "Berechne 4‚Åµ", answers: ["1024", "512", "256"], correct: 2 },
       { question: "Berechne die Wurzel aus 64", answers: ["7", "8", "9"], correct: 1 },
       { question: "Berechne 3‚Å¥", answers: ["81", "64", "72"], correct: 0 },
       { question: "Berechne die Wurzel aus 1000", answers: ["31.62", "30", "32"], correct: 0 },
       { question: "Berechne 5¬≤", answers: ["30", "25", "20"], correct: 1 },
       { question: "Berechne die Wurzel aus 196", answers: ["12", "13", "14"], correct: 2 },
       { question: "Berechne 6¬≤", answers: ["36", "30", "40"], correct: 0 },
       { question: "Berechne die Wurzel aus 81", answers: ["9", "8", "10"], correct: 0 },
       { question: "Berechne 3‚Å∂", answers: ["729", "512", "1024"], correct: 0 },
       { question: "Berechne die Wurzel aus 16", answers: ["4", "5", "6"], correct: 0 },
       { question: "Berechne 8¬≤", answers: ["64", "72", "50"], correct: 0 },
       { question: "Berechne die Wurzel aus 625", answers: ["25", "26", "24"], correct: 0 },
       { question: "Berechne 7‚Å¥", answers: ["2401", "1296", "1024"], correct: 0 },
       { question: "Berechne die Wurzel aus 49", answers: ["7", "6", "8"], correct: 0 },
       { question: "Berechne 2‚Åπ", answers: ["512", "256", "1024"], correct: 0 },
       { question: "Berechne die Wurzel aus 64", answers: ["8", "7", "9"], correct: 0 },
       { question: "Berechne 9¬≥", answers: ["729", "512", "1000"], correct: 0 },
       { question: "Berechne die Wurzel aus 400", answers: ["22", "20", "18"], correct: 1 },
       { question: "Berechne 10‚Å¥", answers: ["10000", "1000", "5000"], correct: 0 },
       { question: "Berechne die Wurzel aus 256", answers: ["16", "15", "18"], correct: 0 },
       { question: "Berechne 4¬≥", answers: ["128", "64", "256"], correct: 2 },
       { question: "Berechne die Wurzel aus 25", answers: ["6", "4", "5"], correct: 2 },
       { question: "Berechne 2‚Å∂", answers: ["32", "64", "128"], correct: 1 },
       { question: "Berechne die Wurzel aus 100", answers: ["10", "11", "9"], correct: 0 }
      ],

      deutsch: [
    { question: "Setze das Satzzeichen richtig: Der Hund der vor dem Haus liegt ist sehr zutraulich.", answers: ["nach: 'der Hund'", "nach: 'vor dem Haus'", "nach: 'sehr'"], correct: 0 },
    { question: "Setze das Satzzeichen richtig: Wir fahren morgen nach Berlin weil wir dort Verwandte besuchen wollen.", answers: ["nach: 'fahren'", "nach: 'Berlin'", "nach: 'morgen'"], correct: 1 },
    { question: "Setze das Satzzeichen richtig: Ich m√∂chte heute ins Kino gehen aber ich habe keine Lust alleine zu gehen.", answers: ["nach: 'gehen'", "nach: 'Lust'", "nach: 'alleine'"], correct: 0 },
    { question: "Setze das Satzzeichen richtig: Sie hat gestern das Buch das sie von ihrer Freundin bekommen hat gelesen.", answers: ["nach: 'bekommen'", "nach: von", "nach: 'Buch'"], correct: 2 },
    { question: "Aktiv oder Passivsatz: Der Hund wird von den Kindern gef√ºttert.", answers: ["Aktiv", "Wei√ü ich nicht", "Passiv"], correct: 2 },
    { question: "Aktiv oder Passivsatz: Die Kinder spielen im Garten.", answers: ["Passiv", "Wei√ü ich nicht", "Aktiv"], correct: 2 },
    { question: "Aktiv oder Passivsatz: Die Lehrerin erkl√§rt den Sch√ºlern die Grammatik ", answers: ["Aktiv", "Wei√ü ich nicht", "Passiv"], correct: 0 },
    { question: "Aktiv oder Passivsatz: Der Kuchen wird morgen gebacken.", answers: ["Aktiv", "Wei√ü ich nicht", "Passiv"], correct: 2 },
    { question: "Haupt oder Nebensatz: Weil sie so m√ºde war, ging sie fr√ºh ins Bett", answers: ["Hauptsatz", "Wei√ü ich nicht", "Nebensatz"], correct: 2 },
    { question: "Haupt oder Nebensatz: Sie ging fr√ºh ins Bett, weil sie so m√ºde war.", answers: ["Hauptsatz", "Wei√ü ich nicht", "Nebensatz"], correct: 0 },
    { question: "Haupt oder Nebensatz: Als der Wecker klingelte, stand ich auf.", answers: ["Hauptsatz", "Wei√ü ich nicht", "Nebensatz"], correct: 2 },
    { question: "Was ist ein Synonym f√ºr sch√∂n", answers: ["h√ºbsch", "komisch", "h√§sslich"], correct: 0 },
    { question: "Was ist ein Synonym f√ºr schnell", answers: ["langsam", "rasch", "klein"], correct: 1 },
    { question: "Was ist das Subjekt im Satz: 'Der Hund l√§uft im Park.'?", answers: ["Der Hund", "l√§uft", "im Park"], correct: 0 },
    { question: "Bestimme das Objekt im Satz: 'Maria gibt ihrem Bruder ein Geschenk.'", answers: ["Maria", "gibt", "ein Geschenk"], correct: 2 },
    { question: "Welche Funktion hat der Satzteil 'im Sommer' im Satz: 'Im Sommer gehen wir oft wandern.'?", answers: ["Subjekt", "Pr√§dikat", "adverbiale Bestimmung der Zeit"], correct: 2 },
    { question: "Wie lautet das Pr√§dikat im Satz: 'Die Sch√ºler schreiben die Pr√ºfung.'?", answers: ["Die Sch√ºler", "schreiben", "die Pr√ºfung"], correct: 1 },
    { question: "Bestimme das Subjekt im Satz: 'Gestern hat der Lehrer den Test korrigiert.'", answers: ["Gestern", "der Lehrer", "den Test"], correct: 1 },
    { question: "Welches Satzglied ist im folgenden Satz an erster Stelle: 'Mit Freude spielte er die Melodie.'?", answers: ["Mit Freude", "spielte", "die Melodie"], correct: 0 },
    { question: "Welches Wort ist das Pr√§dikat im Satz: 'Die V√∂gel singen jeden Morgen.'?", answers: ["Die V√∂gel", "singen", "jeden Morgen"], correct: 1 },
    { question: "Wie lautet die adverbiale Bestimmung des Ortes im Satz: 'Sie f√§hrt jeden Tag zur Arbeit.'?", answers: ["jeden Tag", "f√§hrt", "zur Arbeit"], correct: 2 },
    { question: "Bestimme die Funktion des Satzteils 'im Garten' im Satz: 'Die Kinder spielen im Garten.'", answers: ["Subjekt", "adverbiale Bestimmung des Ortes", "Pr√§dikat"], correct: 1 },
    { question: "Was ist das Objekt im Satz: 'Er liest ein Buch.'?", answers: ["Er", "liest", "ein Buch"], correct: 2 },
    { question: "Welches Satzglied ist das Pr√§dikat im Satz: 'Die Katze schl√§ft den ganzen Tag.'?", answers: ["Die Katze", "schl√§ft", "den ganzen Tag"], correct: 1 },
    { question: "Bestimme das Subjekt im Satz: 'Im Winter schneit es oft.'", answers: ["Im Winter", "schneit", "es"], correct: 2 },
    { question: "Was ist das Pr√§dikat im Satz: 'Abends kocht mein Vater das Abendessen.'?", answers: ["Abends", "kocht", "mein Vater"], correct: 1 },
    { question: "Was ist die adverbiale Bestimmung des Ortes im Satz: 'Die Kinder spielen im Park.'?", answers: ["Die Kinder", "spielen", "im Park"], correct: 2 },
    { question: "Bestimme das Objekt im Satz: 'Sie schenkt ihrem Freund ein Buch.'", answers: ["Sie", "schenkt", "ein Buch"], correct: 2 },
    { question: "Welches Satzglied ist 'fr√ºh am Morgen' im Satz: 'Fr√ºh am Morgen f√§hrt er zur Arbeit.'?", answers: ["adverbiale Bestimmung der Zeit", "Subjekt", "Pr√§dikat"], correct: 0 },
    { question: "Bestimme das Subjekt im Satz: 'An diesem Tag ist das Wetter sehr sch√∂n.'", answers: ["An diesem Tag", "das Wetter", "ist"], correct: 1 },
    { question: "Welche Funktion hat der Satzteil 'mit seiner Schwester' im Satz: 'Er geht mit seiner Schwester in den Park.'?", answers: ["adverbiale Bestimmung des Ortes", "Pr√§dikat", "adverbiale Bestimmung der Begleitung"], correct: 2 },
    { question: "Bestimme das Pr√§dikat im Satz: 'Die Katze springt auf das Sofa.'", answers: ["Die Katze", "springt", "auf das Sofa"], correct: 1 },
    { question: "Bestimme die adverbiale Bestimmung der Zeit im Satz: 'Am Abend liest er immer ein Buch.'", answers: ["Am Abend", "liest", "ein Buch"], correct: 0 },
    { question: "Setze das Komma richtig: Ich mag √Ñpfel ___ Birnen.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Wir gehen ins Kino ___ weil es regnet.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Lehrer erkl√§rt die Aufgabe.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Aufgabe wird vom Lehrer erkl√§rt.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich kaufte Brot ___ Milch ___ und Eier.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Peter ging nach Hause ___ er war m√ºde.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Katze f√§ngt die Maus.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Maus wird von der Katze gefangen.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich wei√ü nicht ___ ob er kommt.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Ich habe Hunger ___ trotzdem esse ich nichts.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Polizei untersucht den Unfall.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Unfall wird von der Polizei untersucht.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Er spielt Fu√üball ___ Basketball ___ und Tennis.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Ich hoffe ___ dass du kommst.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Hund bei√üt den Mann.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Mann wird vom Hund gebissen.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich lese ein Buch ___ w√§hrend ich Musik h√∂re.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Sie mag √Ñpfel ___ Birnen ___ und Trauben.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Kinder bauen einen Sandkasten.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Ein Sandkasten wird von den Kindern gebaut.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich gehe nach Hause ___ weil es sp√§t ist.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Er lachte laut ___ doch niemand h√∂rte ihn.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Mechaniker repariert das Auto.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Das Auto wird vom Mechaniker repariert.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Wir fahren nach Berlin ___ und besuchen Freunde.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Ich wei√ü nicht ___ ob er die Wahrheit sagt.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Mutter kocht das Mittagessen.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Das Mittagessen wird von der Mutter gekocht.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Er kam zu sp√§t ___ weil der Bus versp√§tet war.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Ich ging ins Kino ___ doch der Film war ausverkauft.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der K√ºnstler malt ein Bild.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Ein Bild wird vom K√ºnstler gemalt.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Sie mag Hunde ___ Katzen ___ und V√∂gel.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Ich glaube ___ dass er gewinnt.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Lehrer korrigiert die Klausur.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Klausur wird vom Lehrer korrigiert.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich esse Pizza ___ und trinke Cola.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Wir gehen ins Theater ___ obwohl wir m√ºde sind.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Koch bereitet das Essen zu.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Das Essen wird vom Koch zubereitet.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich mag Schokolade ___ aber keine Bonbons.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Er wollte kommen ___ doch er war krank.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Die Sch√ºler schreiben einen Aufsatz.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Ein Aufsatz wird von den Sch√ºlern geschrieben.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 },
    { question: "Setze das Komma richtig: Ich lese ein Buch ___ w√§hrend ich Tee trinke.", answers: [",", ";", "."], correct: 0 },
    { question: "Setze das Komma richtig: Wir gehen spazieren ___ obwohl es regnet.", answers: [",", ";", "."], correct: 0 },
    { question: "Aktiviere oder Passiv: Der Hund bewacht das Haus.", answers: ["Aktiv", "Passiv", "Keins"], correct: 0 },
    { question: "Aktiviere oder Passiv: Das Haus wird vom Hund bewacht.", answers: ["Aktiv", "Passiv", "Keins"], correct: 1 }
      ],

      englisch: [
        { question: "what is right: I (never/see) such a beautiful movie before.", answers: ["never saw", "have never seen", "see"], correct: 1 },
        { question: "what is right: He (visit) London last summer.", answers: ["visitet", "visited", "visit"], correct: 1 },
        { question: "what is right: We (already/eat) lunch when she arrived.", answers: ["had aten", "have ate", "had already eaten"], correct: 2},
        { question: "what is right: They (live) in Paris for three years", answers: ["have lived", "livet", "had lived"], correct: 0 },
        { question: "fill in the blanks: I am going ______ the cinema.", answers: ["tu", "to", "do"], correct: 1 },
        { question: "fill in the blanks: She was born ______ 1990.", answers: ["in", "on", "in the"], correct: 0 },
        { question: "fill in the blanks: They arrived ______ 7 o'clock. ", answers: ["am", "on", "at"], correct: 2 },
        { question: "fill in the blanks: We‚Äôre meeting ______ Monday. ", answers: ["at", "on", "in"], correct: 1 },
        { question: "fill in the blanks: I‚Äôve been waiting ______ an hour.", answers: ["for", "since", "at"], correct: 0 },
        { question: "what is a synonym for: Happy", answers: ["joyful", "sad", "cry"], correct: 0 },
        { question: "what is a synonym for: fast", answers: ["slow", "speedy", "run"], correct: 1 },
        { question: "what is a synonym for: difficult ", answers: ["easy", "hard", "slow"], correct: 1 },
        { question: "what is a synonym for: Important  ", answers: ["esay", "Happy", "significant"], correct: 2 },
        { question: "what is a synonym for: Start ", answers: ["begin", "speak", "read"], correct: 0 },
        { question: "fill in the blanks: This gift is ______ you.", answers: ["from", "on", "for"], correct: 2 },
        { question: "Wie lautet have in simple past?", answers: ["had", "have", "hod"], correct: 0 },
        { question: "What is the correct form: I (go) to the store yesterday.", answers: ["went", "goes", "going"], correct: 0 },
        { question: "Choose the correct sentence: He (study) English every day.", answers: ["He study English every day.", "He studies English every day.", "He studied English every day."], correct: 1 },
        { question: "Which one is the synonym of 'happy'?", answers: ["sad", "joyful", "angry"], correct: 1 },
        { question: "Choose the correct sentence: She (read) a book when I called her.", answers: ["She reads a book when I called her.", "She read a book when I called her.", "She was reading a book when I called her."], correct: 2 },
        { question: "Fill in the blank: They arrived ______ 8 o'clock.", answers: ["on", "at", "in"], correct: 1 },
        { question: "What is the plural of 'child'?", answers: ["children", "childs", "childes"], correct: 0 },
        { question: "Which is the correct form: He (never/see) a movie like that before.", answers: ["never saw", "has never seen", "never seen"], correct: 1 },
        { question: "Choose the correct sentence: I (be) to Paris last summer.", answers: ["I were to Paris last summer.", "I am to Paris last summer.", "I was to Paris last summer."], correct: 2 },
        { question: "Fill in the blank: We haven't seen her ______ last week.", answers: ["since", "for", "on"], correct: 0 },
        { question: "Which one is correct? I (not/understand) the question.", answers: ["I don't understand the question.", "I doesn't understand the question.", "I not understand the question."], correct: 0 },
        { question: "What is the opposite of 'old'?", answers: ["young", "new", "modern"], correct: 1 },
        { question: "Fill in the blank: I will wait ______ the bus stop.", answers: ["at", "on", "in"], correct: 0 },
        { question: "Which sentence is correct?", answers: ["I have meet her before.", "I met her before.", "I have met her before."], correct: 2 },
        { question: "What is the correct form: They (live) in this city for 10 years.", answers: ["They lived in this city for 10 years.", "They have lived in this city for 10 years.", "They live in this city for 10 years."], correct: 1 },
        { question: "Fill in the blank: She is the (smart) student in the class.", answers: ["smarter", "smartest", "more smart"], correct: 1 },
        { question: "Choose the correct form: I (finish) my homework when you called.", answers: ["I finish my homework when you called.", "I finished my homework when you called.", "I had finished my homework when you called."], correct: 2 },
        { question: "What is the past tense of 'run'?", answers: ["runned", "ran", "run"], correct: 1 },
        { question: "What is the past tense of 'run'?", answers: ["runned", "ran", "run"], correct: 1 },
        { question: "Which one is the correct word? He is always (late) for class.", answers: ["lateness", "late", "lates"], correct: 1 },
        { question: "Fill in the blank: We will go to the cinema ______ it stops raining.", answers: ["until", "before", "after"], correct: 2 },
        { question: "What is the opposite of 'hot'?", answers: ["cold", "warm", "cool"], correct: 0 },
        { question: "What is the correct plural form of 'goose'?", answers: ["gooses", "geese", "goosees"], correct: 1 },
        { question: "Fill in the blank: I have been working here ______ two years.", answers: ["for", "since", "during"], correct: 0 },
        { question: "What is the synonym of 'difficult'?", answers: ["easy", "hard", "simple"], correct: 1 },
        { question: "Which of the following is correct? I have seen him (yesterday).", answers: ["I have seen him yesterday.", "I seen him yesterday.", "I saw him yesterday."], correct: 2 },
        { question: "What is the correct sentence?", answers: ["She don't like coffee.", "She doesn't like coffee.", "She doesn't likes coffee."], correct: 1 },
        { question: "Fill in the blank: I will call you when I (arrive) home.", answers: ["arrived", "arriving", "arrives"], correct: 2 },
        { question: "Choose the correct question form: (you/go) to the party last weekend?", answers: ["Did you went to the party last weekend?", "Do you went to the party last weekend?", "Did you go to the party last weekend?"], correct: 2 },
        { question: "Which one is correct?", answers: ["She is more taller than me.", "She is the most taller than me.", "She is taller than me."], correct: 2 },
        { question: "What is the opposite of 'light'?", answers: ["heavy", "dark", "bright"], correct: 0 }

      ]
    }
  };


  const state = {
    isLoggedIn: false,
    isBanned: false,
    banReason: '',
    userName: '',
    userCoins: 0,
    userRichtig: 0,
    userFalsch: 0,
    userHighscore: 0,
    newsText: '',
    currentTab: 'profil',
    currentQuestion: null,
    feedback: null,
    loginInput: '',
    userId: null,
    
    // Auth State
    authStep: 'username', // 'username', 'pin-new', 'pin-login'
    pin: '',
    tempUserData: null,
    
    // Flappy Bird Game
    gameActive: false,
    gameOver: false,
    bird: { y: 150, velocity: 0 },
    pipes: [],
    gameScore: 0,
    gameFrameId: null
  };

  const appElement = document.getElementById('app');

  // === Helper Functions ===
  
  function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function getRandomQuestion(subject) {
    const questions = configData.questions[subject];
    const q = questions[Math.floor(Math.random() * questions.length)];
    // Shuffle answers
    const shuffledAnswers = shuffleArray(q.answers.map((ans, idx) => ({ text: ans, originalIndex: idx })));
    return {
      question: q.question,
      answers: shuffledAnswers.map(a => a.text),
      correct: shuffledAnswers.findIndex(a => a.originalIndex === q.correct)
    };
  }

  // === Firebase Functions ===
  
  async function loadNewsFromFirebase() {
    try {
      const newsDocRef = doc(db, "app_config", "news");
      const newsDoc = await getDoc(newsDocRef);
      if (newsDoc.exists()) {
        return newsDoc.data().text || '';
      } else {
        return 'Keine aktuellen Infos verf√ºgbar.';
      }
    } catch (error) {
      console.error("Firebase Fehler beim Laden der News:", error);
      return 'Fehler beim Laden der Infos.';
    }
  }

  async function loadUserFromFirebase(name) {
    try {
      const normalizedName = name.toLowerCase();
      const userDocRef = doc(db, "users", normalizedName);
      const userDoc = await getDoc(userDocRef);
      
      if (userDoc.exists()) {
        return userDoc.data();
      } else {
        return null; // User existiert nicht
      }
    } catch (error) {
      console.error("Firebase Fehler beim Laden:", error);
      return null;
    }
  }

  async function createUserInFirebase(name, pin) {
    try {
      const normalizedName = name.toLowerCase();
      const now = new Date().toISOString();
      const newUser = {
        name: name,
        pin: pin,
        coins: 0,
        richtig: 0,
        falsch: 0,
        highscore: 0,
        ban: false,
        banReason: "",
        accountCreated: now,
        lastLogin: now,
        totalLogins: 1
      };
      const userDocRef = doc(db, "users", normalizedName);
      await setDoc(userDocRef, newUser);
      return newUser;
    } catch (error) {
      console.error("Firebase Fehler beim Erstellen:", error);
      return null;
    }
  }

  async function updateLoginStats() {
    if (!state.userId) return;
    try {
      const normalizedUserId = state.userId.toLowerCase();
      const userDocRef = doc(db, "users", normalizedUserId);
      const userDoc = await getDoc(userDocRef);
      
      if (userDoc.exists()) {
        const currentLogins = userDoc.data().totalLogins || 0;
        await updateDoc(userDocRef, {
          lastLogin: new Date().toISOString(),
          totalLogins: currentLogins + 1
        });
      }
    } catch (error) {
      console.error("Firebase Fehler beim Update Login Stats:", error);
    }
  }

 // function user daten laden 
 async function refreshUserData() {
  if (!state.userId) return;

  const data = await loadUserFromFirebase(state.userId);
  if (!data) return;

  // Coins & Stats neu laden
  state.userCoins = data.coins || 0;
  state.userRichtig = data.richtig || 0;
  state.userFalsch = data.falsch || 0;
  state.userHighscore = data.highscore || 0;

  // Ban-Status neu laden
  state.isBanned = data.ban || false;
  state.banReason = data.banReason || "";

  render();
}



  async function saveUserToFirebase() {
    if (!state.userId) return;
    try {
      const normalizedUserId = state.userId.toLowerCase();
      const userDocRef = doc(db, "users", normalizedUserId);
      await updateDoc(userDocRef, {
        coins: state.userCoins,
        richtig: state.userRichtig,
        falsch: state.userFalsch,
        highscore: state.userHighscore
      });
    } catch (error) {
      console.error("Firebase Fehler beim Speichern:", error);
    }
  }

  // === Auth Actions ===
  
  async function handleUsernameSubmit() {
    const input = state.loginInput.trim();
    if (!input) return;
    
    const userData = await loadUserFromFirebase(input);
    
    if (userData) {
      // User existiert - PIN Login
      state.tempUserData = userData;
      state.authStep = 'pin-login';
      state.pin = '';
    } else {
      // Neuer User - PIN erstellen
      state.tempUserData = { name: input };
      state.authStep = 'pin-new';
      state.pin = '';
    }
    render();
  }

  function handlePinInput(digit) {
    if (state.pin.length < 4) {
      state.pin += digit;
      render();
      
      if (state.pin.length === 4) {
        setTimeout(() => handlePinComplete(), 300);
      }
    }
  }

  function handlePinDelete() {
    if (state.pin.length > 0) {
      state.pin = state.pin.slice(0, -1);
      render();
    }
  }

  async function handlePinComplete() {
    if (state.authStep === 'pin-new') {
      // Neuen User erstellen
      const newUser = await createUserInFirebase(state.tempUserData.name, state.pin);
      if (newUser) {
        await loginUser(newUser);
      }
    } else if (state.authStep === 'pin-login') {
      // PIN √ºberpr√ºfen
      if (state.pin === state.tempUserData.pin) {
        await loginUser(state.tempUserData);
      } else {
        // Falscher PIN
        state.pin = '';
        alert('Falscher PIN! Bitte versuche es erneut.');
        render();
      }
    }
  }

  async function loginUser(userData) {
    if (userData.ban === true) {
      state.isBanned = true;
      state.banReason = userData.banReason || "Kein Grund angegeben";
      state.userName = userData.name;
      render();
      return;
    }
    
    const newsData = await loadNewsFromFirebase();
    
    state.userName = userData.name;
    state.userCoins = userData.coins || 0;
    state.userRichtig = userData.richtig || 0;
    state.userFalsch = userData.falsch || 0;
    state.userHighscore = userData.highscore || 0;
    state.newsText = newsData;
    state.userId = userData.name;
    state.isLoggedIn = true;
    state.isBanned = false;
    state.currentQuestion = getRandomQuestion('mathe');
    
    await updateLoginStats();
    render();
  }

  function handleLogout() {
    state.isLoggedIn = false;
    state.userName = '';
    state.userCoins = 0;
    state.userRichtig = 0;
    state.userFalsch = 0;
    state.userHighscore = 0;
    state.userId = null;
    state.loginInput = '';
    state.authStep = 'username';
    state.pin = '';
    state.tempUserData = null;
    state.currentTab = 'mathe';
    state.currentQuestion = null;
    state.feedback = null;
    stopFlappyBird();
    render();
  }

  // === Question Actions ===
  
  async function handleAnswer(index) {
    if (!state.currentQuestion || state.feedback) return;
    const isCorrect = index === state.currentQuestion.correct;
    if (isCorrect) {
      state.userCoins += 1;
      state.userRichtig += 1;
      state.feedback = 'correct';
      await saveUserToFirebase();
    } else {
      state.userFalsch += 1;
      state.feedback = 'wrong';
      await saveUserToFirebase();
    }

    render();
    setTimeout(() => {
      state.feedback = null;
      if (!['spiele','profil'].includes(state.currentTab)) {
        state.currentQuestion = getRandomQuestion(state.currentTab);
      }
      render();
    }, 1500);
  }



async function handleTabChange(tab) {
  state.currentTab = tab;
  state.feedback = null;

  // üëâ Immer Daten neu laden, egal welcher Tab
  await refreshUserData();

  if (['mathe','deutsch','englisch'].includes(tab)) {
    state.currentQuestion = getRandomQuestion(tab);
  } else {
    state.currentQuestion = null;
  }

  render();
}





  // === Flappy Bird Game ===
  
  let canvas, ctx;
  const GRAVITY = 0.3;
  const JUMP_STRENGTH = -5;
  const PIPE_WIDTH = 60;
  const PIPE_GAP = 150;
  const PIPE_SPEED = 3;

  async function startFlappyBird() {
    if (state.userCoins < 2) return;
    
    state.userCoins -= 2;
    await saveUserToFirebase();
    
    state.gameActive = true;
    state.gameOver = false;
    state.gameScore = 0;
    state.bird = { y: 150, velocity: 0 };
    state.pipes = [];
    
    render();
    
    // Wait for canvas to be rendered
    setTimeout(() => {
      canvas = document.getElementById('gameCanvas');
      if (!canvas) return;
      ctx = canvas.getContext('2d');
      gameLoop();
    }, 100);
  }

  function gameLoop() {
    if (!state.gameActive || !canvas) return;
    
    // Update bird
    state.bird.velocity += GRAVITY;
    state.bird.y += state.bird.velocity;
    
    // Check ground/ceiling collision
    if (state.bird.y > 350 || state.bird.y < 0) {
      endFlappyBird();
      return;
    }
    
    // Update pipes
    state.pipes.forEach(pipe => {
      pipe.x -= PIPE_SPEED;
      
      // Check collision
      if (pipe.x < 100 && pipe.x > 20) {
        if (state.bird.y < pipe.top || state.bird.y > pipe.top + PIPE_GAP) {
          endFlappyBird();
          return;
        }
      }
      
      // Score when passing pipe
      if (!pipe.scored && pipe.x < 50) {
        pipe.scored = true;
        state.gameScore++;
      }
    });
    
    // Remove off-screen pipes
    state.pipes = state.pipes.filter(p => p.x > -PIPE_WIDTH);
    
    // Add new pipes
    if (state.pipes.length === 0 || state.pipes[state.pipes.length - 1].x < 200) {
      const topHeight = 50 + Math.random() * 150;
      state.pipes.push({
        x: 400,
        top: topHeight,
        scored: false
      });
    }
    
    // Draw
    drawFlappyBird();
    
    state.gameFrameId = requestAnimationFrame(gameLoop);
  }

  function drawFlappyBird() {
    if (!ctx) return;
    
    // Clear
    ctx.fillStyle = '#87CEEB';
    ctx.fillRect(0, 0, 400, 400);
    
    // Draw pipes
    ctx.fillStyle = '#22C55E';
    state.pipes.forEach(pipe => {
      // Top pipe
      ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
      // Bottom pipe
      ctx.fillRect(pipe.x, pipe.top + PIPE_GAP, PIPE_WIDTH, 400 - pipe.top - PIPE_GAP);
    });
    
    // Draw bird
    ctx.fillStyle = '#FBBF24';
    ctx.beginPath();
    ctx.arc(60, state.bird.y, 15, 0, Math.PI * 2);
    ctx.fill();
    
    // Draw score
    ctx.fillStyle = '#1F2937';
    ctx.font = 'bold 24px sans-serif';
    ctx.fillText(`Score: ${state.gameScore}`, 10, 30);
  }

  function jumpBird() {
    if (state.gameActive) {
      state.bird.velocity = JUMP_STRENGTH;
    }
  }

  async function endFlappyBird() {
    if (!state.gameActive) return;
    
    state.gameActive = false;
    state.gameOver = true;
    
    if (state.gameScore > state.userHighscore) {
      state.userHighscore = state.gameScore;
      await saveUserToFirebase();
    }
    
    if (state.gameFrameId) {
      cancelAnimationFrame(state.gameFrameId);
      state.gameFrameId = null;
    }
    
    render();
  }

  function stopFlappyBird() {
    state.gameActive = false;
    state.gameOver = false;
    if (state.gameFrameId) {
      cancelAnimationFrame(state.gameFrameId);
      state.gameFrameId = null;
    }
  }

  // === Render Functions ===
  
  function renderBanned() {
    return `
      <div class="flex items-center justify-center min-h-screen bg-gradient-to-br from-red-50 to-red-100 p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
          <div class="text-center mb-8">
            <div class="inline-block p-4 bg-red-500 rounded-full mb-4 text-white text-4xl">üö´</div>
            <h1 class="text-3xl font-bold text-red-600 mb-2">Account gesperrt</h1>
            <p class="text-gray-600 mb-4">Dein Account wurde von einem Administrator gesperrt.</p>
            <div class="bg-red-50 rounded-2xl p-6 border-2 border-red-200">
              <p class="text-sm font-semibold text-red-800 mb-2">Grund:</p>
              <p class="text-red-700">${state.banReason}</p>
            </div>
          </div>
          <p class="text-center text-gray-500 text-sm">Wenn du denkst, dass dies ein Fehler ist, kontaktiere bitte einen Administrator.</p>
        </div>
      </div>
    `;
  }

  function renderLogin() {
    if (state.authStep === 'username') {
      return `
        <div class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
              <div class="inline-block p-4 bg-blue-500 rounded-full mb-4 text-white text-4xl">üìö</div>
              <h1 class="text-3xl font-bold text-gray-800 mb-2">Willkommen!</h1>
              <p class="text-gray-600">Gib deinen Namen ein, um zu starten</p>
            </div>
            <input id="loginInput" type="text" value="" placeholder="Dein Name" class="w-full px-6 py-4 text-lg border-2 border-gray-300 rounded-2xl mb-4 focus:outline-none focus:border-blue-500 transition-colors" />
            <button id="loginBtn" class="w-full bg-blue-500 text-white py-4 rounded-2xl text-lg font-semibold hover:bg-blue-600 transition-colors shadow-lg">Weiter</button>
          </div>
        </div>
      `;
    } else if (state.authStep === 'pin-new' || state.authStep === 'pin-login') {
      const isNew = state.authStep === 'pin-new';
      return `
        <div class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
          <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
              <div class="inline-block p-4 bg-blue-500 rounded-full mb-4 text-white text-4xl">üîê</div>
              <h1 class="text-2xl font-bold text-gray-800 mb-2">${isNew ? 'PIN erstellen' : 'PIN eingeben'}</h1>
              <p class="text-gray-600 mb-6">${isNew ? 'W√§hle einen 4-stelligen PIN' : 'Gib deinen PIN ein'}</p>
              
              <div class="flex justify-center gap-4 mb-8">
                ${[0,1,2,3].map(i => `<div class="pin-dot ${i < state.pin.length ? 'filled' : ''}"></div>`).join('')}
              </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-4">
              ${[1,2,3,4,5,6,7,8,9].map(n => `
                <button class="pin-btn bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-2xl font-bold py-6 rounded-full transition-all" data-digit="${n}">${n}</button>
              `).join('')}
              <div></div>
              <button class="pin-btn bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-2xl font-bold py-6 rounded-full transition-all" data-digit="0">0</button>
              <button id="pinDelete" class="bg-red-100 hover:bg-red-200 active:bg-red-300 text-2xl py-6 rounded-full transition-all">‚å´</button>
            </div>
          </div>
        </div>
      `;
    }
  }

  function renderHeader() {
    const title = state.currentTab === 'spiele' ? 'Spiele' : state.currentTab === 'profil' ? 'Profil' : state.currentTab === 'mathe' ? 'Mathe' : state.currentTab === 'deutsch' ? 'Deutsch' : 'Englisch';
    return `
      <div class="bg-white shadow-sm px-6 py-4 flex items-center justify-between">
        <h2 class="text-2xl font-bold text-gray-800 capitalize">${title}</h2>
        <div class="flex items-center gap-3">
          <div class="flex items-center bg-yellow-100 px-4 py-2 rounded-full">
            <span class="text-2xl mr-2">ü™ô</span>
            <span class="font-bold text-lg text-yellow-700" id="coinCount">${state.userCoins}</span>
          </div>
          ${state.currentTab === 'profil' ? `
            <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white p-3 rounded-xl transition-all shadow-lg">
              <span class="text-xl">üö™</span>
            </button>
          ` : ''}
        </div>
      </div>
    `;
  }

  function renderProfile() {
    return `
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-3xl shadow-lg p-8 text-center mb-6">
          <div class="w-24 h-24 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full mx-auto mb-4 flex items-center justify-center text-white text-3xl">üë§</div>
          <h3 class="text-3xl font-bold text-gray-800 mb-2">${state.userName}</h3>
          <div class="flex items-center justify-center gap-3 mt-6 bg-yellow-50 py-4 px-6 rounded-2xl">
            <span class="text-4xl">ü™ô</span>
            <span class="text-3xl font-bold text-yellow-700">${state.userCoins} M√ºnzen</span>
          </div>
          
          <div class="grid grid-cols-2 gap-4 mt-6">
            <div class="bg-green-50 p-4 rounded-2xl border-2 border-green-200">
              <div class="text-3xl mb-2">‚úÖ</div>
              <div class="text-2xl font-bold text-green-700">${state.userRichtig}</div>
              <div class="text-sm text-green-600">Richtig</div>
            </div>
            <div class="bg-red-50 p-4 rounded-2xl border-2 border-red-200">
              <div class="text-3xl mb-2">‚ùå</div>
              <div class="text-2xl font-bold text-red-700">${state.userFalsch}</div>
              <div class="text-sm text-red-600">Falsch</div>
            </div>
          </div>
          
          <div class="bg-purple-50 p-4 rounded-2xl border-2 border-purple-200 mt-4">
            <div class="text-3xl mb-2">üèÜ</div>
            <div class="text-2xl font-bold text-purple-700">${state.userHighscore}</div>
            <div class="text-sm text-purple-600">Flappy Bird Highscore</div>
          </div>
        </div>
        
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-3xl shadow-lg p-6 border-2 border-blue-200">
          <div class="flex items-center gap-2 mb-3">
            <span class="text-2xl">üì¢</span>
            <h4 class="text-xl font-bold text-gray-800">Neueste Infos</h4>
          </div>
          <p class="text-gray-700 text-lg leading-relaxed news-text">${state.newsText}</p>
        </div>
      </div>
    `;
  }

  function renderGameIntro() {
    return `
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-3xl shadow-lg p-8 text-center">
          <div class="text-yellow-500 text-6xl mb-4">üê¶</div>
          <h3 class="text-2xl font-bold text-gray-800 mb-4">Flappy Bird</h3>
          <p class="text-gray-600 mb-6">Fliege durch die R√∂hren und sammle Punkte!</p>
          
          ${state.userHighscore > 0 ? `
            <div class="bg-purple-50 rounded-2xl p-4 mb-6 border-2 border-purple-200">
              <p class="text-sm text-purple-600 mb-1">Dein Highscore</p>
              <p class="text-3xl font-bold text-purple-700">üèÜ ${state.userHighscore}</p>
            </div>
          ` : ''}
          
          <div class="bg-yellow-50 rounded-2xl p-6 mb-6">
            <p class="text-lg text-yellow-700 font-semibold mb-2">Kosten: 2 M√ºnzen</p>
            <p class="text-sm text-yellow-600">Tippe oder klicke, um zu fliegen!</p>
            <p class="text-xs text-yellow-500 mt-2">eidoton</p>
          </div>
          <button id="startGameBtn" class="w-full py-4 rounded-2xl text-lg font-semibold transition-colors ${state.userCoins>=2? 'bg-yellow-500 text-white hover:bg-yellow-600 shadow-lg' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}">${state.userCoins>=2? 'Spiel starten!' : 'Nicht genug M√ºnzen'}</button>
        </div>
      </div>
    `;
  }

  function renderGameActive() {
    return `
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-3xl shadow-lg p-6">
          <div class="mb-4 flex justify-between items-center">
            <div class="text-xl font-bold text-blue-600">Score: ${state.gameScore}</div>
            <button id="endGameBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-semibold transition-all">Beenden</button>
          </div>
          <canvas id="gameCanvas" width="400" height="400" class="w-full cursor-pointer"></canvas>
          <p class="text-center text-gray-600 mt-4 text-sm">eidoton</p>
        </div>
      </div>
    `;
  }

  function renderGameOver() {
    return `
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-3xl shadow-lg p-8 text-center">
          <div class="text-6xl mb-4">üí•</div>
          <h3 class="text-3xl font-bold text-gray-800 mb-4">Game Over!</h3>
          <div class="bg-blue-50 rounded-2xl p-6 mb-4">
            <p class="text-2xl font-bold text-blue-700 mb-2">${state.gameScore} Punkte</p>
          </div>
          ${state.gameScore === state.userHighscore && state.gameScore > 0 ? `
            <div class="bg-purple-50 rounded-2xl p-4 mb-6 border-2 border-purple-200">
              <p class="text-lg font-bold text-purple-700">üéâ Neuer Highscore! üéâ</p>
            </div>
          ` : ''}
          <button id="tryAgainBtn" class="w-full py-4 rounded-2xl text-lg font-semibold transition-colors ${state.userCoins>=2? 'bg-yellow-500 text-white hover:bg-yellow-600 shadow-lg' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}">${state.userCoins>=2? 'Nochmal spielen!' : 'Nicht genug M√ºnzen'}</button>
        </div>
      </div>
    `;
  }

  function renderQuestionCard() {
    if (!state.currentQuestion) return '';
    const answersHtml = state.currentQuestion.answers.map((a,i) => {
      const base = 'w-full p-6 text-xl font-medium rounded-2xl transition-all transform active:scale-95';
      let classes = 'bg-blue-50 text-blue-900 hover:bg-blue-100 border-2 border-blue-200';
      if (state.feedback === 'correct' && i === state.currentQuestion.correct) classes = 'bg-green-500 text-white shadow-lg';
      else if (state.feedback === 'wrong' && i === state.currentQuestion.correct) classes = 'bg-green-500 text-white shadow-lg';
      else if (state.feedback === 'wrong') classes = 'bg-red-100 text-red-700 border-2 border-red-300';
      return `<button data-ans="${i}" class="answerBtn ${base} ${classes}" ${state.feedback? 'disabled': ''}>${a}</button>`;
    }).join('');

    return `
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-3xl shadow-lg p-8 mb-6">
          <p class="text-2xl font-semibold text-gray-800 text-center mb-8">${state.currentQuestion.question}</p>
          <div class="space-y-4">${answersHtml}</div>
          ${state.feedback === 'correct' ? `<div class="mt-6 text-center"><p class="text-2xl font-bold text-green-600">Richtig! üéâ</p><p class="text-lg text-green-600 mt-2">+1 M√ºnze</p></div>` : ''}
          ${state.feedback === 'wrong' ? `<div class="mt-6 text-center"><p class="text-2xl font-bold text-red-600">Leider falsch üòî</p><p class="text-lg text-gray-600 mt-2">Versuch's nochmal!</p></div>` : ''}
        </div>
      </div>
    `;
  }

  function renderBottomNav() {
    const c = state.currentTab;
    function cls(tab, color) { 
      const isActive = c === tab;
      return `flex flex-col items-center p-4 rounded-xl transition-all ${isActive ? color + ' tab-active' : 'text-gray-500'}`;
    }
    return `
      <div class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-lg">
        <div class="flex justify-around items-center py-1 max-w-2xl mx-auto">
          <button data-tab="spiele" class="${cls('spiele','text-purple-600')}">
            <div class="text-3xl mb-1">üéÆ</div>
            <span class="text-xs font-semibold">Spiele</span>
          </button>
          <button data-tab="mathe" class="${cls('mathe','text-blue-600')}">
            <div class="text-3xl mb-1">üî¢</div>
            <span class="text-xs font-semibold">Mathe</span>
          </button>
          <button data-tab="deutsch" class="${cls('deutsch','text-red-600')}">
            <div class="text-3xl mb-1">üìò</div>
            <span class="text-xs font-semibold">Deutsch</span>
          </button>
          <button data-tab="englisch" class="${cls('englisch','text-green-600')}">
            <div class="text-3xl mb-1">üåç</div>
            <span class="text-xs font-semibold">Englisch</span>
          </button>
          <button data-tab="profil" class="${cls('profil','text-indigo-600')}">
            <div class="text-3xl mb-1">üë§</div>
            <span class="text-xs font-semibold">Profil</span>
          </button>
        </div>
      </div>
    `;
  }

  function render() {
    if (state.isBanned) {
      appElement.innerHTML = renderBanned();
      return;
    }

    if (!state.isLoggedIn) {
      appElement.innerHTML = renderLogin();
      
      if (state.authStep === 'username') {
        const inp = document.getElementById('loginInput');
        if (inp) {
          inp.value = state.loginInput;
          inp.addEventListener('input', (e) => { state.loginInput = e.target.value; });
          inp.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUsernameSubmit(); });
        }
        const btn = document.getElementById('loginBtn');
        if (btn) btn.addEventListener('click', handleUsernameSubmit);
      } else {
        // PIN pad
        document.querySelectorAll('.pin-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const digit = e.currentTarget.getAttribute('data-digit');
            handlePinInput(digit);
          });
        });
        const delBtn = document.getElementById('pinDelete');
        if (delBtn) delBtn.addEventListener('click', handlePinDelete);
      }
      return;
    }

    // Main view
    appElement.innerHTML = `
      ${renderHeader()}
      <div class="flex-1 overflow-y-auto p-6 pb-24">
        ${state.currentTab === 'profil' ? renderProfile() : ''}
        ${state.currentTab === 'spiele' ? (state.gameActive ? renderGameActive() : state.gameOver ? renderGameOver() : renderGameIntro()) : ''}
        ${(['mathe','deutsch','englisch'].includes(state.currentTab) && state.currentQuestion) ? renderQuestionCard() : ''}
      </div>
      ${renderBottomNav()}
    `;

    // Attach handlers
    const coinEl = document.getElementById('coinCount'); 
    if (coinEl) coinEl.textContent = state.userCoins;

    // Logout button
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) logoutBtn.addEventListener('click', () => {
      if (confirm('M√∂chtest du dich wirklich ausloggen?')) {
        handleLogout();
      }
    });

    // Game handlers
    const startBtn = document.getElementById('startGameBtn'); 
    if (startBtn) startBtn.addEventListener('click', startFlappyBird);
    
    const tryBtn = document.getElementById('tryAgainBtn'); 
    if (tryBtn) {
      tryBtn.addEventListener('click', () => { 
        state.gameOver = false; 
        if (state.userCoins >= 10) startFlappyBird(); 
      });
    }
    
    const endBtn = document.getElementById('endGameBtn');
    if (endBtn) endBtn.addEventListener('click', endFlappyBird);
    
    const gameCanvas = document.getElementById('gameCanvas');
    if (gameCanvas && state.gameActive) {
      gameCanvas.addEventListener('click', jumpBird);
      gameCanvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        jumpBird();
      });
    }

    // Answers
    document.querySelectorAll('.answerBtn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = Number(e.currentTarget.getAttribute('data-ans'));
        handleAnswer(idx);
      });
    });

    // Bottom nav
    document.querySelectorAll('[data-tab]').forEach(bt => {
      bt.addEventListener('click', (e) => { 
        handleTabChange(e.currentTarget.getAttribute('data-tab')); 
      });
    });
  }

  // Initial render
  render();

  // Cleanup
  window.addEventListener('beforeunload', () => { 
    stopFlappyBird(); 
  });
  </script>
</body>
</html>